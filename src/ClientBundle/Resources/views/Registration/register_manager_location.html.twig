{% extends "@FOSUser/layout.html.twig" %}

{% block tilebar %}Register Manager Location{% endblock %}
{% block breadcrumbs %}Register Manager Location{% endblock %}

{% block fos_user_content %}

    <div class="container">

        {% trans_default_domain 'FOSUserBundle' %}

        {{ form_start(form, {'method': 'post', 'action': path('manager_location_register'), 'attr': {'class': 'fos_user_registration_register', 'enctype': 'multipart/form-data'}}) }}
        CIN
        {{ form_widget(form.id, {'attr': {'id': 'form_person_edit', 'style':'color:red'}}) }}
        {{ form_widget(form) }}


        <center>
            <h1>Votre Agence : </h1>

            <input type="text" name="nom_agence" placeholder="nom agence"/>
            <br>
            <input type="number" name="tel_agence" placeholder="telephone agence"/>
            <br>
            <input type="text" name="horaire_agence" placeholder="horaire agence"/>
            <br>
            Photo
            <input type="file" name="photo_agence" id="photo_agence" placeholder="photo" onchange="onchangeImgAg()">
            <img id="img_ag" class="img-circle" src="{{ asset('images/no_image.svg') }}" style="width: 100px; height: 100px">
            <br>
            Piece justificatif
            <input type="file" name="piece_agence" id="piece_agence" placeholder="piece" onchange="onchangePieceAg()">
            <img id="piece_ag" class="img-circle" src="{{ asset('images/no_image.svg') }}" style="width: 100px; height: 100px">
            <br>
            <input type="text" name="rue_agence" placeholder="rue agence"/>
            <br>
            <input type="text" name="ville_agence" placeholder="ville agence"/>
            <br>
            <input type="number" name="code_postal_agence" placeholder="code postale agence"/>
            <br>
            <div id="map" style="width: 500px; height: 300px; background-color: red"></div>
            <input type="hidden" name="lat_agence" id="lat_agence" value="0" />
            <input type="hidden" name="lng_agence" id="lng_agence" value="0" />
        </center>



        <div>
            manager location
            <input type="submit" value="{{ 'registration.submit'|trans }}" />
        </div>
        {{ form_end(form) }}



        <script src="{{ asset('client/js/jquery-1.11.1.min.js') }}"></script>
        <script>
            function onchangeImgAg(){
                input = document.getElementById('photo_agence');
                file = input.files[0];
                console.log(file);

                fr = new FileReader();
                fr.onload = showImage;
                //fr.readAsText(file);
                fr.readAsDataURL(file);

                function showImage() {
                    $("#img_ag").attr("src",fr.result);
                }
            }

            function onchangePieceAg(){
                input = document.getElementById('piece_agence');
                file = input.files[0];
                console.log(file);

                fr = new FileReader();
                fr.onload = showImage;
                //fr.readAsText(file);
                fr.readAsDataURL(file);

                function showImage() {
                    $("#piece_ag").attr("src",fr.result);
                }
            }
        </script>

        <script>

            function initMap() {
                var myLatLng = {lat: 36.772315, lng: 10.0375315};

                var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 10,
                    center: myLatLng
                });






                // Try HTML5 geolocation.
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        var pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };

                        map.setCenter(pos);
                        var marker = new google.maps.Marker({
                            position: pos,
                            map: map,
                            title: 'Emplacement Agence',
                            draggable: true
                        });
                        google.maps.event.addListener(marker, 'dragend', function(evt){
                            //$('#emplacement_lat').val(evt.latLng.lat());
                            //$('#emplacement_lng').val(evt.latLng.lng());
                            document.getElementById('lat_agence').value = evt.latLng.lat();
                            document.getElementById('lng_agence').value = evt.latLng.lng();
                            //document.getElementById('current').innerHTML = '<p>Marker dropped: Current Lat: ' + evt.latLng.lat().toFixed(3) + ' Current Lng: ' + evt.latLng.lng().toFixed(3) + '</p>';
                        });
                    }, function() {
                        //handleLocationError(true, infoWindow, map.getCenter());
                        var marker = new google.maps.Marker({
                            position: myLatLng,
                            map: map,
                            title: 'Emplacement Agence',
                            draggable: true
                        });
                        google.maps.event.addListener(marker, 'dragend', function(evt){
                            document.getElementById('lat_agence').value = evt.latLng.lat();
                            document.getElementById('lng_agence').value = evt.latLng.lng();
                            //document.getElementById('current').innerHTML = '<p>Marker dropped: Current Lat: ' + evt.latLng.lat().toFixed(3) + ' Current Lng: ' + evt.latLng.lng().toFixed(3) + '</p>';
                        });
                        alert('Error: The Geolocation service failed.');
                    });
                } else {
                    // Browser doesn't support Geolocation
                    //handleLocationError(false, infoWindow, map.getCenter());
                    var marker = new google.maps.Marker({
                        position: myLatLng,
                        map: map,
                        title: 'Emplacement Agence',
                        draggable: true
                    });
                    google.maps.event.addListener(marker, 'dragend', function(evt){
                        document.getElementById('lat_agence').value = evt.latLng.lat();
                        document.getElementById('lng_agence').value = evt.latLng.lng();
                        //document.getElementById('current').innerHTML = '<p>Marker dropped: Current Lat: ' + evt.latLng.lat().toFixed(3) + ' Current Lng: ' + evt.latLng.lng().toFixed(3) + '</p>';
                    });
                    alert('Error: The Geolocation service failed.');
                }

            }

            function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                infoWindow.setPosition(pos);
                infoWindow.setContent(browserHasGeolocation ?
                    'Error: The Geolocation service failed.' :
                    'Error: Your browser doesn\'t support geolocation.');
            }

        </script>
        <script async defer
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD00UW-yFHi17pDyHLe19_ImRpo0ja5Q3k&callback=initMap">
        </script>
    </div>


{% endblock fos_user_content %}
